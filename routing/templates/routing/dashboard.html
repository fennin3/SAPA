<div class="container">
  <!--begin::Education-->
  <div class="d-flex flex-column flex-md-row">
    <!--begin::Aside-->
    <div class="flex-md-row-auto w-md-275px w-xl-325px">
      <!--begin::Nav Panel Widget 3-->
      <div class="card card-custom gutter-b">
        <!--begin::Body-->
        <div class="card-body">
          <!--begin::Wrapper-->
          <div class="d-flex justify-content-between flex-column h-100">
            <!--begin::Container-->
            <div class="h-100">
              <!--begin::Header-->
              <div class="d-flex flex-column flex-center">
                <!--begin::Image-->
                <div
                  class="bgi-no-repeat bgi-size-cover rounded min-h-180px w-100"
                  style="background-image: url(library/media/img-70.jpg)"
                ></div>
                <!--end::Image-->
                <!--begin::Title-->
                <a
                  href="#"
                  class="card-title font-weight-bolder text-dark-75 text-hover-primary font-size-h4 m-0 pt-7 pb-1 active_constituency"
                ></a>
                <!--end::Title-->
                <!--begin::Text-->
                <div class="font-weight-bold text-dark-50 font-size-sm pb-7">
                  Short description
                </div>
                <!--end::Text-->
              </div>
              <!--end::Header-->
              <!--begin::Body-->
              <div class="pt-1">
                <!--begin::Item-->
                <div class="d-flex align-items-center pb-9">
                  <!--begin::Symbol-->
                  <div class="symbol symbol-45 symbol-light mr-4">
                    <span class="symbol-label">
                      <span class="svg-icon svg-icon-2x svg-icon-dark-50">
                        <!--begin::Svg Icon | path:assets/media/svg/icons/Media/Equalizer.svg-->
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          xmlns:xlink="http://www.w3.org/1999/xlink"
                          width="24px"
                          height="24px"
                          viewBox="0 0 24 24"
                          version="1.1"
                        >
                          <g
                            stroke="none"
                            stroke-width="1"
                            fill="none"
                            fill-rule="evenodd"
                          >
                            <rect x="0" y="0" width="24" height="24" />
                            <rect
                              fill="#000000"
                              opacity="0.3"
                              x="13"
                              y="4"
                              width="3"
                              height="16"
                              rx="1.5"
                            />
                            <rect
                              fill="#000000"
                              x="8"
                              y="9"
                              width="3"
                              height="11"
                              rx="1.5"
                            />
                            <rect
                              fill="#000000"
                              x="18"
                              y="11"
                              width="3"
                              height="9"
                              rx="1.5"
                            />
                            <rect
                              fill="#000000"
                              x="3"
                              y="13"
                              width="3"
                              height="7"
                              rx="1.5"
                            />
                          </g>
                        </svg>
                        <!--end::Svg Icon-->
                      </span>
                    </span>
                  </div>
                  <!--end::Symbol-->
                  <!--begin::Text-->
                  <div class="d-flex flex-column flex-grow-1">
                    <a
                      href="#"
                      class="text-dark-75 text-hover-primary mb-1 font-size-lg font-weight-bolder"
                      >All</a
                    >
                    <span class="text-muted font-weight-bold"
                      >Total Projects</span
                    >
                  </div>
                  <!--end::Text-->
                  <!--begin::label-->
                  <span
                    class="font-weight-bolder label label-xl label-light-success label-inline px-3 py-5 min-w-45px"
                    >200</span
                  >
                  <!--end::label-->
                </div>
                <!--end::Item-->
                <!--begin::Item-->
                <div class="d-flex align-items-center pb-9">
                  <!--begin::Symbol-->
                  <div class="symbol symbol-45 symbol-light mr-4">
                    <span class="symbol-label">
                      <span class="svg-icon svg-icon-2x svg-icon-dark-50">
                        <!--begin::Svg Icon | path:assets/media/svg/icons/Communication/Group.svg-->
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          xmlns:xlink="http://www.w3.org/1999/xlink"
                          width="24px"
                          height="24px"
                          viewBox="0 0 24 24"
                          version="1.1"
                        >
                          <g
                            stroke="none"
                            stroke-width="1"
                            fill="none"
                            fill-rule="evenodd"
                          >
                            <polygon points="0 0 24 0 24 24 0 24" />
                            <path
                              d="M18,14 C16.3431458,14 15,12.6568542 15,11 C15,9.34314575 16.3431458,8 18,8 C19.6568542,8 21,9.34314575 21,11 C21,12.6568542 19.6568542,14 18,14 Z M9,11 C6.790861,11 5,9.209139 5,7 C5,4.790861 6.790861,3 9,3 C11.209139,3 13,4.790861 13,7 C13,9.209139 11.209139,11 9,11 Z"
                              fill="#000000"
                              fill-rule="nonzero"
                              opacity="0.3"
                            />
                            <path
                              d="M17.6011961,15.0006174 C21.0077043,15.0378534 23.7891749,16.7601418 23.9984937,20.4 C24.0069246,20.5466056 23.9984937,21 23.4559499,21 L19.6,21 C19.6,18.7490654 18.8562935,16.6718327 17.6011961,15.0006174 Z M0.00065168429,20.1992055 C0.388258525,15.4265159 4.26191235,13 8.98334134,13 C13.7712164,13 17.7048837,15.2931929 17.9979143,20.2 C18.0095879,20.3954741 17.9979143,21 17.2466999,21 C13.541124,21 8.03472472,21 0.727502227,21 C0.476712155,21 -0.0204617505,20.45918 0.00065168429,20.1992055 Z"
                              fill="#000000"
                              fill-rule="nonzero"
                            />
                          </g>
                        </svg>
                        <!--end::Svg Icon-->
                      </span>
                    </span>
                  </div>
                  <!--end::Symbol-->
                  <!--begin::Text-->
                  <div class="d-flex flex-column flex-grow-1">
                    <a
                      href="#"
                      class="text-dark-75 text-hover-primary mb-1 font-size-lg font-weight-bolder"
                      >Failed</a
                    >
                    <span class="text-muted font-weight-bold"
                      >Failed Fellas</span
                    >
                  </div>
                  <!--end::Text-->
                  <!--begin::label-->
                  <span
                    class="font-weight-bolder label label-xl label-light-danger label-inline px-3 py-5 min-w-45px"
                    >50</span
                  >
                  <!--end::label-->
                </div>
                <!--end::Item-->
                <!--begin::Item-->
                <div class="d-flex align-items-center pb-9">
                  <!--begin::Symbol-->
                  <div class="symbol symbol-45 symbol-light mr-4">
                    <span class="symbol-label">
                      <span class="svg-icon svg-icon-2x svg-icon-dark-50">
                        <!--begin::Svg Icon | path:assets/media/svg/icons/Home/Globe.svg-->
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          xmlns:xlink="http://www.w3.org/1999/xlink"
                          width="24px"
                          height="24px"
                          viewBox="0 0 24 24"
                          version="1.1"
                        >
                          <g
                            stroke="none"
                            stroke-width="1"
                            fill="none"
                            fill-rule="evenodd"
                          >
                            <rect x="0" y="0" width="24" height="24" />
                            <path
                              d="M13,18.9450712 L13,20 L14,20 C15.1045695,20 16,20.8954305 16,22 L8,22 C8,20.8954305 8.8954305,20 10,20 L11,20 L11,18.9448245 C9.02872877,18.7261967 7.20827378,17.866394 5.79372555,16.5182701 L4.73856106,17.6741866 C4.36621808,18.0820826 3.73370941,18.110904 3.32581341,17.7385611 C2.9179174,17.3662181 2.88909597,16.7337094 3.26143894,16.3258134 L5.04940685,14.367122 C5.46150313,13.9156769 6.17860937,13.9363085 6.56406875,14.4106998 C7.88623094,16.037907 9.86320756,17 12,17 C15.8659932,17 19,13.8659932 19,10 C19,7.73468744 17.9175842,5.65198725 16.1214335,4.34123851 C15.6753081,4.01567657 15.5775721,3.39010038 15.903134,2.94397499 C16.228696,2.49784959 16.8542722,2.4001136 17.3003976,2.72567554 C19.6071362,4.40902808 21,7.08906798 21,10 C21,14.6325537 17.4999505,18.4476269 13,18.9450712 Z"
                              fill="#000000"
                              fill-rule="nonzero"
                            />
                            <circle
                              fill="#000000"
                              opacity="0.3"
                              cx="12"
                              cy="10"
                              r="6"
                            />
                          </g>
                        </svg>
                        <!--end::Svg Icon-->
                      </span>
                    </span>
                  </div>
                  <!--end::Symbol-->
                  <!--begin::Text-->
                  <div class="d-flex flex-column flex-grow-1">
                    <a
                      href="#"
                      class="text-dark-75 text-hover-primary mb-1 font-size-lg font-weight-bolder"
                      >Completed</a
                    >
                    <span class="text-muted font-weight-bold"
                      >Successful Fellas</span
                    >
                  </div>
                  <!--end::Text-->
                  <!--begin::label-->
                  <span
                    class="font-weight-bolder label label-xl label-light-primary label-inline py-5 min-w-45px"
                    >25</span
                  >
                  <!--end::label-->
                </div>
                <!--end::Item-->
                <!--begin::Item-->
                <div class="d-flex align-items-center pb-9">
                  <!--begin::Symbol-->
                  <div class="symbol symbol-45 symbol-light mr-4">
                    <span class="symbol-label">
                      <span class="svg-icon svg-icon-2x svg-icon-dark-50">
                        <!--begin::Svg Icon | path:assets/media/svg/icons/Layout/Layout-4-blocks.svg-->
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          xmlns:xlink="http://www.w3.org/1999/xlink"
                          width="24px"
                          height="24px"
                          viewBox="0 0 24 24"
                          version="1.1"
                        >
                          <g
                            stroke="none"
                            stroke-width="1"
                            fill="none"
                            fill-rule="evenodd"
                          >
                            <rect x="0" y="0" width="24" height="24" />
                            <rect
                              fill="#000000"
                              x="4"
                              y="4"
                              width="7"
                              height="7"
                              rx="1.5"
                            />
                            <path
                              d="M5.5,13 L9.5,13 C10.3284271,13 11,13.6715729 11,14.5 L11,18.5 C11,19.3284271 10.3284271,20 9.5,20 L5.5,20 C4.67157288,20 4,19.3284271 4,18.5 L4,14.5 C4,13.6715729 4.67157288,13 5.5,13 Z M14.5,4 L18.5,4 C19.3284271,4 20,4.67157288 20,5.5 L20,9.5 C20,10.3284271 19.3284271,11 18.5,11 L14.5,11 C13.6715729,11 13,10.3284271 13,9.5 L13,5.5 C13,4.67157288 13.6715729,4 14.5,4 Z M14.5,13 L18.5,13 C19.3284271,13 20,13.6715729 20,14.5 L20,18.5 C20,19.3284271 19.3284271,20 18.5,20 L14.5,20 C13.6715729,20 13,19.3284271 13,18.5 L13,14.5 C13,13.6715729 13.6715729,13 14.5,13 Z"
                              fill="#000000"
                              opacity="0.3"
                            />
                          </g>
                        </svg>
                        <!--end::Svg Icon-->
                      </span>
                    </span>
                  </div>
                  <!--end::Symbol-->
                  <!--begin::Text-->
                  <div class="d-flex flex-column flex-grow-1">
                    <a
                      href="#"
                      class="text-dark-75 text-hover-primary mb-1 font-size-lg font-weight-bolder"
                      >Pipeline</a
                    >
                    <span class="text-muted font-weight-bold"
                      >Waiting Fellas</span
                    >
                  </div>
                  <!--end::Text-->
                  <!--begin::label-->
                  <span
                    class="font-weight-bolder label label-xl label-light-info label-inline px-3 py-5 min-w-45px"
                    >75</span
                  >
                  <!--end::label-->
                </div>
                <!--end::Item-->
              </div>
              <!--end::Body-->
            </div>
            <!--eng::Container-->
            <!--begin::Footer-->
            <div
              class="d-flex flex-center"
              id="kt_sticky_toolbar_chat_toggler_2"
              data-toggle="tooltip"
              title=""
              data-placement="right"
              data-original-title="Chat Example"
            >
              <button
                class="btn btn-primary font-weight-bolder font-size-sm py-3 px-14"
                data-toggle="modal"
                data-target="#kt_chat_modal"
              >
                Contact MP
              </button>
            </div>
            <!--end::Footer-->
          </div>
          <!--end::Wrapper-->
        </div>
        <!--end::Body-->
      </div>
      <!--end::Nav Panel Widget 3-->

      <!--begin::List Widget 9-->
      <div class="card card-custom gutter-b">
        <!--begin::Header-->
        <div class="card-header align-items-center border-0 mt-4">
          <h3 class="card-title align-items-start flex-column">
            <span class="font-weight-bolder text-dark">Activities</span>
            <span class="text-muted mt-3 font-weight-bold font-size-sm"
              >890,344 Activities</span
            >
          </h3>
          <div class="card-toolbar">
            <div class="dropdown dropdown-inline">
              <a
                href="#"
                class="btn btn-clean btn-hover-light-primary btn-sm btn-icon"
                data-toggle="dropdown"
                aria-haspopup="true"
                aria-expanded="false"
              >
                <i class="ki ki-bold-more-hor"></i>
              </a>
              <div class="dropdown-menu dropdown-menu-md dropdown-menu-right">
                <!--begin::Navigation-->
                <ul class="navi navi-hover">
                  <li class="navi-header font-weight-bold py-4">
                    <span class="font-size-lg">Choose Label:</span>
                    <i
                      class="flaticon2-information icon-md text-muted"
                      data-toggle="tooltip"
                      data-placement="right"
                      title="Click to learn more..."
                    ></i>
                  </li>
                  <li class="navi-separator mb-3 opacity-70"></li>
                  <li class="navi-item">
                    <a href="#" class="navi-link">
                      <span class="navi-text">
                        <span
                          class="label label-xl label-inline label-light-success"
                          >Customer</span
                        >
                      </span>
                    </a>
                  </li>
                  <li class="navi-item">
                    <a href="#" class="navi-link">
                      <span class="navi-text">
                        <span
                          class="label label-xl label-inline label-light-danger"
                          >Partner</span
                        >
                      </span>
                    </a>
                  </li>
                  <li class="navi-item">
                    <a href="#" class="navi-link">
                      <span class="navi-text">
                        <span
                          class="label label-xl label-inline label-light-warning"
                          >Suplier</span
                        >
                      </span>
                    </a>
                  </li>
                  <li class="navi-item">
                    <a href="#" class="navi-link">
                      <span class="navi-text">
                        <span
                          class="label label-xl label-inline label-light-primary"
                          >Member</span
                        >
                      </span>
                    </a>
                  </li>
                  <li class="navi-item">
                    <a href="#" class="navi-link">
                      <span class="navi-text">
                        <span
                          class="label label-xl label-inline label-light-dark"
                          >Staff</span
                        >
                      </span>
                    </a>
                  </li>
                  <li class="navi-separator mt-3 opacity-70"></li>
                  <li class="navi-footer py-4">
                    <a class="btn btn-clean font-weight-bold btn-sm" href="#">
                      <i class="ki ki-plus icon-sm"></i>Add new</a
                    >
                  </li>
                </ul>
                <!--end::Navigation-->
              </div>
            </div>
          </div>
        </div>
        <!--end::Header-->
        <!--begin::Body-->
        <div class="card-body pt-4">
          <!--begin::Timeline-->
          <div class="timeline timeline-6 mt-3">
            <!--begin::Item-->
            <div class="timeline-item align-items-start">
              <!--begin::Label-->
              <div
                class="timeline-label font-weight-bolder text-dark-75 font-size-lg"
              >
                08:42
              </div>
              <!--end::Label-->
              <!--begin::Badge-->
              <div class="timeline-badge">
                <i class="fa fa-genderless text-warning icon-xl"></i>
              </div>
              <!--end::Badge-->
              <!--begin::Text-->
              <div
                class="font-weight-mormal font-size-lg timeline-content text-muted pl-3"
              >
                Outlines keep you honest. And keep structure
              </div>
              <!--end::Text-->
            </div>
            <!--end::Item-->
            <!--begin::Item-->
            <div class="timeline-item align-items-start">
              <!--begin::Label-->
              <div
                class="timeline-label font-weight-bolder text-dark-75 font-size-lg"
              >
                10:00
              </div>
              <!--end::Label-->
              <!--begin::Badge-->
              <div class="timeline-badge">
                <i class="fa fa-genderless text-success icon-xl"></i>
              </div>
              <!--end::Badge-->
              <!--begin::Content-->
              <div class="timeline-content d-flex">
                <span class="font-weight-bolder text-dark-75 pl-3 font-size-lg"
                  >AEOL meeting</span
                >
              </div>
              <!--end::Content-->
            </div>
            <!--end::Item-->
          </div>
          <!--end::Timeline-->
        </div>
        <!--end: Card Body-->
      </div>
      <!--end: List Widget 9-->
    </div>
    <!--end::Aside-->
    <!--begin::Content-->
    <div class="flex-row-fluid ml-md-6 ml-lg-8">
      <div class="row">
        <div class="col-xxl-12" id="mp_feed">
          <div id="mp_feed_data"></div>

          <div class="text-center pb-7 pb-xxl-1">
            <a
              class="btn btn-primary font-weight-bolder font-size-sm py-3 px-9"
              style="display: none"
              id="kt_app_education_more_feeds_btn"
              >More Feeds</a
            >
          </div>
        </div>
      </div>
    </div>
    <!--end::Content-->
  </div>
  <!--end::Education-->
</div>
<script type="text/javascript">
  var getInitials = (string) => {
    var names = string.split(" "),
      initials = names[0].substring(0, 1).toUpperCase();

    if (names.length > 1) {
      initials += names[names.length - 1].substring(0, 1).toUpperCase();
    }
    return initials;
  };

  var user_status = "";
  if (!user_details.is_mp) {
    user_status = "Constituent";
    $("#mp_entry").hide();
  } else {
    user_status = "MP";
  }

  $(".user_name").text(user_details.full_name);
  $(".user_status").text(user_status);
  $(".user_email").text(user_details.email);
  $(".user_initials").text(getInitials(user_details.full_name));

  $.get(
    "http://localhost:8000/general/get-actionplan-status/",
    function (data) {
      console.log("data", data);

      if (data.status === 200) {
        if (data.action_plan_status === true) {
          $("#show_plan").show();

          fetchActions();
        }
      }
    }
  );

  var fetchActions = () => {
    $.get(
      "http://localhost:8000/constituent-operations/action-titles/",
      function (data) {
        console.log("actions", data);
        if (data.status === 200) {
          var actions = data.data;

          var action_form = $("#action_form");

          for (var action in actions) {
            action_form.append(`
							<div class="form-group row">
								<label class="col-3 col-form-label">${actions[action].title}</label>
								<div class="col-9 col-form-label">
									<div class="radio-inline">
										<label class="radio radio-primary">
											<input type="radio" name="${actions[action].title}" value="1"/>
											<span></span>
											1
										</label>
										<label class="radio radio-primary">
											<input type="radio" name="${actions[action].title}" value="2"/>
											<span></span>
											2
										</label>
										<label class="radio radio-primary">
											<input type="radio" name="${actions[action].title}" value="3"/>
											<span></span>
											3
										</label>
										<label class="radio radio-primary">
											<input type="radio" name="${actions[action].title}" value="4"/>
											<span></span>
											4
										</label>
										<label class="radio radio-primary">
											<input type="radio" name="${actions[action].title}" value="5"/>
											<span></span>
											5
										</label>
									</div>
									<span class="form-text text-muted">Rate from lowest to highest</span>
								</div>
							</div>`);
          }
        }
      }
    );
  };

  $("#send_action_data").on("click", function (e) {
    e.preventDefault();

    var action_form = $("#action_form");

    var actionBtn = KTUtil.getById("send_action_data"),
      _buttonSpinner = "spinner spinner-right spinner-white pr-15";

    var endp = `http://localhost:8000/constituent-operations/send-action-plan/${user_details.system_id_for_user}/`;

    $.ajax({
      url: endp,
      method: "POST",
      data: action_form.serialize(),
      cache: false,
      processData: false,
      dataType: "json",
      beforeSend: function () {
        console.log("actp", action_form.serialize());
        KTUtil.btnWait(actionBtn, _buttonSpinner, "Processing", true);
      },
      success: function (data) {
        if (data.status === 200) {
          swal
            .fire({
              text: data.message,
              icon: "success",
              buttonsStyling: false,
              confirmButtonText: "Ok, got it!",
              customClass: {
                confirmButton: "btn font-weight-bold btn-light-danger",
              },
            })
            .then(() => {
              KTUtil.btnRelease(actionBtn);
              $("#action_plan_modal").modal("hide");
              $(".modal-backdrop").remove();
              action_form.trigger("reset");
            });
        } else {
          swal
            .fire({
              text: data.message,
              icon: "error",
              buttonsStyling: false,
              confirmButtonText: "Ok, got it!",
              customClass: {
                confirmButton: "btn font-weight-bold btn-light-danger",
              },
            })
            .then(() => {
              KTUtil.btnRelease(actionBtn);
              $("#action_plan_modal").modal("hide");
              $(".modal-backdrop").remove();
              action_form.trigger("reset");
            });
        }
      },
      error: function (error) {
        console.log("error", error);
        swal.fire({
          text: `Error: ${error.responseJSON?.message || "unknown error"}`,
          icon: "error",
          buttonsStyling: false,
          confirmButtonText: "Ok, got it!",
          customClass: {
            confirmButton: "btn font-weight-bold btn-light-danger",
          },
        });
        KTUtil.btnRelease(actionBtn);
      },
    });
  });

  var fetchData = () => {
    var endpoint = `http://localhost:8000/constituent-operations/retrieve-projects/${user_details.system_id_for_user}/`;

    $.ajax({
      url: endpoint,
      method: "GET",
      beforeSend: function () {
        console.log("edn", endpoint);
        KTApp.block("#mp_feed", {
          overlayColor: "red",
          opacity: 0.1,
          state: "primary",
        });
      },
      success: function (data) {
        console.log("mp_data", data);
        if (data.status === 200) {
          var feeds = data.data;
          console.log("feed", feeds);
          var feed_data = $("#mp_feed_data");
          if (feeds.length === 0) {
            feed_data.append(
              '<div class="card card-custom gutter-b"><div class="card-body"><div class="pt-4"><p class="text-dark-75 font-size-lg font-weight-normal pt-5 mb-2">Ooops! No projects or post have been added</p></div></div></div>'
            );
            $("#kt_app_education_more_feeds_btn").hide();
          } else {
            for (var feed in feeds) {
              feed_data.append(
                `<div class="card card-custom gutter-b" data-id="${
                  feeds[feed].id
                }">
<div class="card-body">
<div class="d-flex align-items-center">
<div class="symbol symbol-40 symbol-light-success mr-5">
<span class="symbol-label"><img src="library/media/047-girl-25.svg" class="h-75 align-self-end" alt="${
                  feeds[feed].name
                }" />
</span></div><div class="d-flex flex-column flex-grow-1">
<a href="#" class="text-dark-75 text-hover-primary mb-1 font-size-lg font-weight-bolder">${
                  feeds[feed].name
                }</a>
<span class="text-muted font-weight-bold">${feeds[feed].place}</span>
</div></div><div class="pt-4">${
                  feeds[feed].media === null
                    ? ""
                    : `<div class="bgi-no-repeat bgi-size-cover rounded min-h-265px" style="background-image: url(${feeds[feed].media})"></div>`
                }
<p class="text-dark-75 font-size-lg font-weight-normal pt-5 mb-2">${
                  feeds[feed].description
                }</p>
<div class="d-flex align-items-center"><a data-toggle="tooltip"   data-placement="top" data-original-title="Comments" href="javascript:void(0)" onclick="toggleShow(this)" class="btn btn-hover-text-primary btn-hover-icon-primary btn-sm btn-text-dark-50 bg-hover-light-primary rounded font-weight-bolder font-size-sm p-2">
<span class="svg-icon svg-icon-md svg-icon-dark-25 pr-2"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
<rect x="0" y="0" width="24" height="24" />
<path d="M16,15.6315789 L16,12 C16,10.3431458 14.6568542,9 13,9 L6.16183229,9 L6.16183229,5.52631579 C6.16183229,4.13107011 7.29290239,3 8.68814808,3 L20.4776218,3 C21.8728674,3 23.0039375,4.13107011 23.0039375,5.52631579 L23.0039375,13.1052632 L23.0206157,17.786793 C23.0215995,18.0629336 22.7985408,18.2875874 22.5224001,18.2885711 C22.3891754,18.2890457 22.2612702,18.2363324 22.1670655,18.1421277 L19.6565168,15.6315789 L16,15.6315789 Z" fill="#000000" />
<path d="M1.98505595,18 L1.98505595,13 C1.98505595,11.8954305 2.88048645,11 3.98505595,11 L11.9850559,11 C13.0896254,11 13.9850559,11.8954305 13.9850559,13 L13.9850559,18 C13.9850559,19.1045695 13.0896254,20 11.9850559,20 L4.10078614,20 L2.85693427,21.1905292 C2.65744295,21.3814685 2.34093638,21.3745358 2.14999706,21.1750444 C2.06092565,21.0819836 2.01120804,20.958136 2.01120804,20.8293182 L2.01120804,18.32426 C1.99400175,18.2187196 1.98505595,18.1104045 1.98505595,18 Z M6.5,14 C6.22385763,14 6,14.2238576 6,14.5 C6,14.7761424 6.22385763,15 6.5,15 L11.5,15 C11.7761424,15 12,14.7761424 12,14.5 C12,14.2238576 11.7761424,14 11.5,14 L6.5,14 Z M9.5,16 C9.22385763,16 9,16.2238576 9,16.5 C9,16.7761424 9.22385763,17 9.5,17 L11.5,17 C11.7761424,17 12,16.7761424 12,16.5 C12,16.2238576 11.7761424,16 11.5,16 L9.5,16 Z" fill="#000000" opacity="0.3" />
</g></svg></span>${
                  feeds[feed].comments.length
                }</a><a data-toggle="tooltip"   data-placement="right" data-original-title="${
                  feeds[feed].likes.includes(user_details.id)
                    ? "Unlike"
                    : "Like"
                }"  href="javascript:void(0)" data-id="${
                  feeds[feed].id
                }" onclick="sendLike(this)"   class="btn btn-icon-danger btn-sm btn-text-dark-50 bg-hover-light-danger ${
                  feeds[feed].likes.includes(user_details.id)
                    ? "bg-light-danger active"
                    : ""
                } btn-hover-text-danger rounded font-weight-bolder font-size-sm p-2" >
<span class="svg-icon svg-icon-md svg-icon-danger pr-1"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><polygon points="0 0 24 0 24 24 0 24" />
<path d="M16.5,4.5 C14.8905,4.5 13.00825,6.32463215 12,7.5 C10.99175,6.32463215 9.1095,4.5 7.5,4.5 C4.651,4.5 3,6.72217984 3,9.55040872 C3,12.6834696 6,16 12,19.5 C18,16 21,12.75 21,9.75 C21,6.92177112 19.349,4.5 16.5,4.5 Z" fill="#000000" fill-rule="nonzero" />
</g></svg></span><span class="like_num">${
                  feeds[feed].likes.length
                }</span></a></div>
${
  feeds[feed].comments.length === 0
    ? `<div class="py-5 comment-box" style="display: none;">
<div class="d-flex flex-column flex-row-fluid">
<span class="text-dark-75 font-size-sm font-weight-normal pt-1">No comments on this post yet. Be the first</span>
</div></div>`
    : feeds[feed].comments
        .map(
          (
            { id, text, comment_from },
            key
          ) => `<div class="py-5 comment-box" style="display: none;"><div class="d-flex flex-column flex-row-fluid">
<div class="d-flex align-items-center flex-wrap"><a href="#" class="text-dark-75 text-hover-primary mb-1 font-size-lg font-weight-bolder pr-6">${comment_from.full_name}</a>
<span class="text-muted font-weight-normal flex-grow-1 font-size-sm">1 Day ago</span>
</div>
<span class="text-dark-75 font-size-sm font-weight-normal pt-1">${text}</span>
</div></div>`
        )
        .join("")
}


</div><div class="separator separator-solid mt-2 mb-4"></div>
<form class="position-relative"><textarea id="kt_forms_widget_4_input"  class="form-control border-0 p-0 pr-10 resize-none" rows="1" placeholder="Comment..."></textarea>
<div class="position-absolute top-0 right-0 mt-n1 mr-n2 send-reply" data-id="${
                  feeds[feed].id
                }" onclick="sendReply(this)" ><span class="btn btn-icon btn-sm btn-hover-icon-primary send-reply" >
<i class="flaticon2-paperplane icon-ms"></i></span></div></form></div></div>`
              );
            }
            $("#kt_app_education_more_feeds_btn").show();
          }
        } else {
          swal.fire({
            text: `Error ${data.message}`,
            icon: "error",
            buttonsStyling: false,
            confirmButtonText: "Ok, got it!",
            customClass: {
              confirmButton: "btn font-weight-bold btn-light-danger",
            },
          });
        }
        KTApp.unblock("#mp_feed");
      },
      error: function (error) {
        console.log("error", error);
        swal.fire({
          text: `An error occurred and that is all we know`,
          icon: "error",
          buttonsStyling: false,
          confirmButtonText: "Ok, got it!",
          customClass: {
            confirmButton: "btn font-weight-bold btn-light-danger",
          },
        });
        KTApp.unblock("#mp_feed");
      },
    });
  };
  var toggleShow = ($this) => {
    // console.log('I am clicked');
    $($this).parent().parent().find("div.comment-box").toggle("fast", "linear");
  };

  var constChange = ($this) => {
    var const_id = $($this).data("id");

    var endpoint = `http://localhost:8000/constituent-operations/switch-active-constituency/${user_details.system_id_for_user}/${const_id}/`;

    $.ajax({
      url: endpoint,
      method: "POST",
      beforeSend: function () {
        console.log("edn", endpoint);
        KTApp.blockPage({
          overlayColor: "#000000",
          state: "primary",
          message: "Updating...",
        });
      },
      success: function (data) {
        console.log("update_response", data);
        if (data.status === 200) {
          swal
            .fire({
              text: data.message,
              icon: "success",
              buttonsStyling: false,
              confirmButtonText: "Ok, got it!",
              customClass: {
                confirmButton: "btn font-weight-bold btn-light-success",
              },
            })
            .then(() => {
              location.reload();
            });
        } else {
          swal.fire({
            text: `Error ${data.message}`,
            icon: "error",
            buttonsStyling: false,
            confirmButtonText: "Ok, got it!",
            customClass: {
              confirmButton: "btn font-weight-bold btn-light-danger",
            },
          });
        }
        KTApp.unblockPage();
      },
      error: function (error) {
        console.log("error", error);
        swal.fire({
          text: `An error occurred and that is all we know`,
          icon: "error",
          buttonsStyling: false,
          confirmButtonText: "Ok, got it!",
          customClass: {
            confirmButton: "btn font-weight-bold btn-light-danger",
          },
        });
        KTApp.unblockPage();
      },
    });
  };
  var active_const = $(".active_constituency");
  var regions = $("#regions"),
    constituencies = $("#constituencies");

  regions.select2({
    placeholder: "Select Region",
  });
  constituencies.select2({
    placeholder: "Select Constituency",
  });

  var loadAddNew = () => {
    var countries = sessionStorage.getItem("countries");
    countries = JSON.parse(countries);

    var region = countries.filter((value, key) => value.id == 1);

    var reg = [];
    region[0].regions.forEach(({ id, name }, key) => {
      reg.push({ id, text: name });
    });
    regions.html("").select2({
      data: [{ id: "", text: "" }, ...reg],
      placeholder: "Select Region",
    });
    regions.removeAttr("disabled");
    constituencies.attr("disabled", "disabled");
    constituencies.html("").select2({ data: [] });
  };

  regions.on("change", function (e) {
    constituencies.attr("disabled", "disabled");
    var reg_id = $(this).val();
    var country = sessionStorage.getItem("countries");
    country = JSON.parse(country);

    var region = country.filter((value, key) => value.id == 1);

    var constituency = region[0].regions.filter(
      (value, key) => value.id == reg_id
    );
    var cons = [];

    constituency[0].constituencies.forEach(({ id, name }, key) => {
      cons.push({ id, text: name });
    });

    constituencies.html("").select2({
      data: [{ id: "", text: "" }, ...cons],
      placeholder: "Select Constituency",
    });
    constituencies.removeAttr("disabled");
  });

  $.ajax({
    url: `http://localhost:8000/general/get-user-info/${user_details.system_id_for_user}/`,
    method: "GET",
    success: function (data) {
      console.log("ddd", data);
      var const_list = $("#const_list");
      var constituencies = data.constituency;
      active_const.text(data.active_constituency.name);
      var add_new_const = $("#add_new_const");
      fetchData();
      if (!user_details.is_mp) {
        add_new_const.show();

        active_const.removeAttr("disabled");
        if (constituencies.length > 1) {
          add_new_const
            .text("Max Limit Reached")
            .attr("onclick", "return false;")
            .removeAttr("data-target")
            .removeAttr("data-toggle");
        }
      }

      for (var con in constituencies) {
        console.log("const", constituencies[con]);
        const_list.append(
          `<li class="navi-item"><a href="javascript:void(0)" data-id="${constituencies[con].id}"  onclick="constChange(this)" class="navi-link"><span class="navi-text">${constituencies[con].name}</span></a></li>`
        );
      }
    },
    error: function (error) {
      console.log("error", error);
    },
  });
  $("#add_const_new").on("click", function (e) {
    e.preventDefault();
    var region = $("#regions").val(),
      constituency = $("#constituencies").val(),
      sendBtn = KTUtil.getById("add_const_new"),
      _buttonSpinner = "spinner spinner-right spinner-white pr-15";

    if (region === "" || constituency === "") {
      return swal.fire({
        text: `Region or Constituency field cannot be empty`,
        icon: "error",
        buttonsStyling: false,
        confirmButtonText: "Ok, got it!",
        customClass: {
          confirmButton: "btn font-weight-bold btn-light-danger",
        },
      });
    }
    var endpoint = `http://localhost:8000/users/create-secondary-account/`;
    $.ajax({
      url: endpoint,
      method: "PUT",
      data: {
        system_id_for_user: user_details.system_id_for_user,
        region,
        constituency,
      },
      cache: false,
      processData: true,
      dataType: "json",
      beforeSend: function () {
        console.log("edn", endpoint);
        KTUtil.btnWait(sendBtn, _buttonSpinner, "Processing", true);
      },
      success: function (data) {
        console.log("new_const", data);
        if (data.status === 200) {
          swal
            .fire({
              text: data.message,
              icon: "success",
              buttonsStyling: false,
              confirmButtonText: "Ok, got it!",
              customClass: {
                confirmButton: "btn font-weight-bold btn-light-success",
              },
            })
            .then(() => {
              location.reload();
            });
        } else {
          swal.fire({
            text: `Error ${data.message}`,
            icon: "error",
            buttonsStyling: false,
            confirmButtonText: "Ok, got it!",
            customClass: {
              confirmButton: "btn font-weight-bold btn-light-danger",
            },
          });
        }
        KTUtil.btnRelease(sendBtn);
      },
      error: function (error) {
        console.log("error", error);
        swal.fire({
          text: `An error occurred and that is all we know`,
          icon: "error",
          buttonsStyling: false,
          confirmButtonText: "Ok, got it!",
          customClass: {
            confirmButton: "btn font-weight-bold btn-light-danger",
          },
        });
        KTUtil.btnRelease(sendBtn);
      },
    });
  });

  var sendReply = ($this) => {
    var project_id = $($this).data("id");
    var comment_body = $($this).parent().find("textarea").val();
    if (comment_body === "") {
      swal.fire({
        text: `Comment body can not be empty`,
        icon: "error",
        buttonsStyling: false,
        confirmButtonText: "Ok, got it!",
        customClass: {
          confirmButton: "btn font-weight-bold btn-light-danger",
        },
      });
    }
    var endpoint = `http://localhost:8000/constituent-operations/comment-on-post/`;
    $.ajax({
      url: endpoint,
      method: "PUT",
      data: {
        user_id: user_details.system_id_for_user,
        project_id,
        comment_body,
      },
      cache: false,
      processData: true,
      dataType: "json",
      beforeSend: function () {
        console.log("edn", endpoint);
        KTApp.blockPage({
          overlayColor: "#000000",
          state: "primary",
          message: "Sending Comment...",
        });
      },
      success: function (data) {
        console.log("reply mesaage", data);
        if (data.status === 200) {
          swal
            .fire({
              text: data.message,
              icon: "success",
              buttonsStyling: false,
              confirmButtonText: "Ok, got it!",
              customClass: {
                confirmButton: "btn font-weight-bold btn-light-success",
              },
            })
            .then(() => {
              location.reload();
            });
        } else {
          swal.fire({
            text: `Error ${data.message}`,
            icon: "error",
            buttonsStyling: false,
            confirmButtonText: "Ok, got it!",
            customClass: {
              confirmButton: "btn font-weight-bold btn-light-danger",
            },
          });
        }
        KTApp.unblockPage();
      },
      error: function (error) {
        console.log("error", error);
        swal.fire({
          text: `An error occurred and that is all we know`,
          icon: "error",
          buttonsStyling: false,
          confirmButtonText: "Ok, got it!",
          customClass: {
            confirmButton: "btn font-weight-bold btn-light-danger",
          },
        });
        KTApp.unblockPage();
      },
    });
  };

  var sendLike = ($this) => {
    var like = $($this);
    var project_id = $($this).data("id");
    var endpoint = `http://localhost:8000/constituent-operations/like-project/${user_details.system_id_for_user}/${project_id}/`;

    var curVal = like.find("span.like_num").text();

    if (like.hasClass("active")) {
      like.find("span.like_num").text(parseInt(curVal) - 1);
      like.removeClass("active").removeClass("bg-light-danger");
      like.attr("data-original-title", "Like");
    } else {
      like.find("span.like_num").text(parseInt(curVal) + 1);
      like.addClass("active").addClass("bg-light-danger");
      like.attr("data-original-title", "Unlike");
    }

    $.ajax({
      url: endpoint,
      method: "PUT",
      cache: false,
      processData: false,
      dataType: "json",
      beforeSend: function () {},
      success: function (data) {
        console.log("reply message", data);
      },
      error: function (error) {
        console.log("error", error);
        swal.fire({
          text: `An error occurred and that is all we know`,
          icon: "error",
          buttonsStyling: false,
          confirmButtonText: "Ok, got it!",
          customClass: {
            confirmButton: "btn font-weight-bold btn-light-danger",
          },
        });
        // KTApp.unblockPage();
      },
    });
  };
  $("body").tooltip({
    selector: '[data-toggle="tooltip"]',
    trigger: "hover",
  });

  var loadChat = () => {
    var user_identity = btoa(btoa(btoa("user_data")));

    var user_data = sessionStorage.getItem(user_identity);

    var user_details = atob(atob(atob(atob(user_data))));
    user_details = JSON.parse(user_details);

    $.ajax({
      url: `http://localhost:8000/constituent-operations/retrieve-messages/${user_details.system_id_for_user}/`,
      method: "GET",
      success: function (data) {
        console.log("messages", data);
        if (data.status === 200) {
          var messages = data.messages;
          var message_box = $(".messages");
          if (messages.length > 0) {
            message_box.html("");
            for (var message in messages) {
              message_box.append(
                `${
                  messages[message].sender.id === user_details.id
                    ? `
											<div class="d-flex flex-column mb-5 align-items-end">
<div class="d-flex align-items-center">
<div><span class="text-muted font-size-sm">${moment(
                        messages[message].date_sent
                      ).fromNow()}</span>
<a href="#" class="text-dark-75 text-hover-primary font-weight-bold font-size-h6">${
                        user_details.full_name
                      }</a>
</div>
<div class="symbol symbol-circle symbol-40 ml-3">
<img alt="Pic" src="assets/media/users/300_21.jpg" />
</div>
</div>
<div class="mt-2 rounded p-5 bg-light-primary text-dark-50 font-weight-bold font-size-lg text-right max-w-400px">${
                        messages[message].message
                      }</div>
</div>
									`
                    : `
<div class="d-flex flex-column mb-5 align-items-start">
<div class="d-flex align-items-center">
<div class="symbol symbol-circle symbol-40 mr-3">
<img alt="Pic" src="assets/media/users/300_12.jpg" />
</div>
<div>
<a href="#" class="text-dark-75 text-hover-primary font-weight-bold font-size-h6">${
                        user_details.full_name
                      }</a>
<span class="text-muted font-size-sm">${moment(
                        messages[message].date_sent
                      ).fromNow()}</span>
</div>
</div>
<div class="mt-2 rounded p-5 bg-light-success text-dark-50 font-weight-bold font-size-lg text-left max-w-400px">${
                        messages[message].message
                      }</div>
</div>
`
                }`
              );
            }
          } else {
            message_box.html(
              '<p class="text muted">There are no messages yet</p>'
            );
          }
          var element = "kt_chat_modal";
          var messagesEl = KTUtil.find(element, ".messages");
          var scrollEl = KTUtil.find(element, ".scroll");

          scrollEl.scrollTop = parseInt(KTUtil.css(messagesEl, "height"));

          var ps;
          if ((ps = KTUtil.data(scrollEl).get("ps"))) {
            ps.update();
          }
        }
      },
      error: function (error) {
        console.log("error", error);
      },
    });
  };
  // setInterval(loadChat, 2000)
  $("#message-send").on("click", function (e) {
    var user_identity = btoa(btoa(btoa("user_data")));

    var user_data = sessionStorage.getItem(user_identity);

    var user_details = atob(atob(atob(atob(user_data))));
    user_details = JSON.parse(user_details);
    e.preventDefault();
    var message_body = $("#message_body_send").val(),
      sendBtn = KTUtil.getById("message-send"),
      _buttonSpinner = "spinner spinner-right spinner-white pr-15";

    if (message_body === "") {
      return swal.fire({
        text: `Message body cannot be empty`,
        icon: "error",
        buttonsStyling: false,
        confirmButtonText: "Ok, got it!",
        customClass: {
          confirmButton: "btn font-weight-bold btn-light-danger",
        },
      });
    }
    var endpoint = `http://localhost:8000/constituent-operations/send-message/`;
    $.ajax({
      url: endpoint,
      method: "POST",
      data: {
        sender_id: user_details.system_id_for_user,
        message: message_body,
        attached_file: null,
      },
      cache: false,
      processData: true,
      dataType: "json",
      beforeSend: function () {
        console.log("edn", endpoint);
        KTUtil.btnWait(sendBtn, _buttonSpinner, "Processing", true);
      },
      success: function (data) {
        console.log("new message", data);
        $("#message_body_send").val("");

        KTUtil.btnRelease(sendBtn);
      },
      error: function (error) {
        console.log("error", error);
        swal.fire({
          text: `An error occurred and that is all we know`,
          icon: "error",
          buttonsStyling: false,
          confirmButtonText: "Ok, got it!",
          customClass: {
            confirmButton: "btn font-weight-bold btn-light-danger",
          },
        });
        KTUtil.btnRelease(sendBtn);
      },
    });
  });
</script>
